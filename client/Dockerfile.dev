FROM node:22-alpine

ARG CLIENT_PORT
ENV CLIENT_PORT ${CLIENT_PORT}

ARG CLIENT_URL
ENV CLIENT_URL ${CLIENT_URL}

ARG SERVER_URL
ENV SERVER_URL ${SERVER_URL}

ARG SERVER_PORT_A
ENV SERVER_PORT_A ${SERVER_PORT_A}

ARG SERVER_HOST
ENV NEXT_PUBLIC_SERVER_HOST ${SERVER_HOST}

ARG SERVER_PROTOCOL
ENV NEXT_PUBLIC_SERVER_PROTOCOL ${SERVER_PROTOCOL}

ENV NEXT_SHARP_PATH=/app/node_modules/sharp

WORKDIR /app

COPY ./package.json .
RUN yarn
COPY ./tsconfig.json .
COPY ./postcss.config.js .
COPY ./next.config.mjs .
COPY ./tailwind.config.ts .
RUN mkdir public
COPY ./public/* public/

CMD yarn dev -p ${CLIENT_PORT}
